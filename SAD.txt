---UI
-- Create a ScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")

-- Create a solid grey Frame to cover the whole screen
local greyFrame = Instance.new("Frame")
greyFrame.Size = UDim2.new(1, 0, 1, 0)
greyFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 50) -- Grey color
greyFrame.BackgroundTransparency = 15 -- No transparency, making it solid
greyFrame.Parent = screenGui

-- Create a TextLabel for "Shiny Hub" with a highlight effect
local shinyHubLabel = Instance.new("TextLabel")
shinyHubLabel.Text = "Shiny Hub"
shinyHubLabel.Size = UDim2.new(0, 400, 0, 100)
shinyHubLabel.Position = UDim2.new(0.5, -200, 0.45, -50) -- Centered horizontally
shinyHubLabel.BackgroundTransparency = 1 -- No background
shinyHubLabel.TextColor3 = Color3.fromRGB(255, 215, 0) -- Gold color for highlight
shinyHubLabel.TextScaled = true -- Scale text to fit
shinyHubLabel.Font = Enum.Font.SourceSansBold
shinyHubLabel.Parent = greyFrame

-- Add a UIStroke to "Shiny Hub" to make it stand out more
local uiStrokeShiny = Instance.new("UIStroke")
uiStrokeShiny.Thickness = 3
uiStrokeShiny.Color = Color3.fromRGB(255, 255, 255) -- White stroke color
uiStrokeShiny.Parent = shinyHubLabel

-- Create a TextLabel for "gem" below "Shiny Hub"
local gemLabel = Instance.new("TextLabel")
gemLabel.Size = UDim2.new(0, 250, 0, 60)
gemLabel.Position = UDim2.new(0.5, -125, 0.55, 0) -- Centered horizontally, below "Shiny Hub"
gemLabel.BackgroundTransparency = 1 -- No background
gemLabel.TextColor3 = Color3.fromRGB(135, 206, 250) -- Light blue color for "gem"
gemLabel.TextScaled = true -- Scale text to fit
gemLabel.Font = Enum.Font.GothamBlack -- Use GothamBlack for a stronger look
gemLabel.Parent = greyFrame

-- Add a UIStroke to "gem" to enhance its appearance
local uiStrokeGem = Instance.new("UIStroke")
uiStrokeGem.Thickness = 4
uiStrokeGem.Color = Color3.fromRGB(0, 0, 139) -- Dark blue stroke color for contrast
uiStrokeGem.Parent = gemLabel

-- Add a UIGradient to "gem" for a gradient effect
local uiGradientGem = Instance.new("UIGradient")
uiGradientGem.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(173, 216, 230)), -- Light blue at the top
    ColorSequenceKeypoint.new(1, Color3.fromRGB(0, 191, 255)) -- Deeper blue at the bottom
}
uiGradientGem.Parent = gemLabel

-- Function to update the gem count
local function updateGemCount()
    local player = game.Players.LocalPlayer
    local gems = player:WaitForChild("Gems").Value -- Assuming "Gems" is an IntValue in the player's character

    -- Update the gemLabel's text to include the gem count
    gemLabel.Text = "gem: " .. tostring(gems)
end

-- Call the function to update the gem count initially
updateGemCount()

-- Optional: Update the gem count whenever the player's gem value changes
game.Players.LocalPlayer:WaitForChild("Gems").Changed:Connect(function()
    updateGemCount()
end)

---Main
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

local basePosition = Vector3.new(-30.740604400634766, 81.7170181274414, 62.73944091796875)
local placementRadius = 1 -- Reduced distance between the towers
local placementIncrement = 1 -- Reduced distance increment for each subsequent tower placement
local voteSkipCount = 0 -- Counter for VoteForSkip

-- Configuration


-- Function to place towers near the base position and gradually move farther away
local function placeTowers()
    for i = 1, 10 do -- Number of towers to place (adjust as needed)
        local position = basePosition + Vector3.new(math.random(-placementRadius, placementRadius), 0, math.random(-placementRadius, placementRadius))
        local args = {
            [1] = LocalPlayer.OwnedTowers:FindFirstChild(G_Tower),
            [2] = CFrame.new(position) * CFrame.Angles(0, 0, 0),
            [3] = false,
            [4] = true
        }
        ReplicatedStorage.Functions.SpawnTower:InvokeServer(unpack(args))
        
        -- Increase the placement radius for the next tower
        placementRadius = placementRadius + placementIncrement
        
        -- Wait 10 seconds before placing the next tower
        wait(10)
    end
end

-- Function to upgrade all placed towers
local function upgradeTowers()
    for _, tower in ipairs(workspace.Towers:GetChildren()) do
        local args = {
            [1] = tower
        }
        ReplicatedStorage.Functions.Upgrade:InvokeServer(unpack(args))
    end
end

-- Function to vote for starting the game
local function voteStartGame()
    ReplicatedStorage.Events.Client.VoteStartGame:FireServer()
end

-- Function to vote for skipping rounds
local function voteForSkip()
    for i = 1, 15 do
        ReplicatedStorage.Functions.VoteForSkip:InvokeServer()
        wait(0.5) -- Adjust the delay between votes if needed
    end
end

-- Auto-replay function that checks if the Mobs folder is empty before replaying
local function autoReplay()
    -- Wait for 2 minutes after VoteForSkip has been called 15 times
    wait(120)
    
    while true do
        local mobsFolder = workspace:FindFirstChild("Mobs")
        if mobsFolder and #mobsFolder:GetChildren() == 0 then
            wait(5) -- Wait 5 seconds before replaying
            local args = {
                [1] = "Replay"
            }
            ReplicatedStorage.Events.ExitGame:FireServer(unpack(args))
        else
            wait(1) -- Check again after 1 second
        end
    end
end

-- Additional functions to trigger when in place ID 15601725874
local function triggerElevatorFunctions()
    if game.PlaceId == 15601725874 then
        local args1 = {
            [1] = "Level",
            [2] = "Infinity"
        }
        workspace.StoryElevators.Elevator.ElevatorServer.ChangeStory:FireServer(unpack(args1))
        
        workspace.StoryElevators.Elevator.ElevatorServer.Choose:FireServer()
        
        workspace.StoryElevators.Elevator.ElevatorServer.QuickStart:FireServer()
    end
end

-- Main loop to handle the tower placement, upgrades, voting, and replay
local function main()
    -- Trigger elevator functions if in the correct place ID
    triggerElevatorFunctions()

    -- Vote to start the game
    voteStartGame()

    -- Vote for skipping rounds 15 times
    voteForSkip()

    -- Start the auto-replay function in a separate thread after voting
    if G_AutoPlay then
        spawn(autoReplay)
    end

    -- Main loop to place towers and upgrade them
    while true do
        placeTowers()
        
        if G_AutoUpgrade then
            upgradeTowers()
        end

        -- Wait 5 seconds before the next placement and upgrade cycle
        wait(5)
    end
end

-- Start the main function
main()
